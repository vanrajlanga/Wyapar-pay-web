(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[637],{6874:function(e,t,r){Promise.resolve().then(r.bind(r,290))},9376:function(e,t,r){"use strict";var s=r(5475);r.o(s,"usePathname")&&r.d(t,{usePathname:function(){return s.usePathname}}),r.o(s,"useRouter")&&r.d(t,{useRouter:function(){return s.useRouter}}),r.o(s,"useSearchParams")&&r.d(t,{useSearchParams:function(){return s.useSearchParams}})},290:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return g}});var s=r(7437),a=r(2265),o=r(9376),n=r(9765),i=r(9034),c=r(9775),l=r(3976),u=r(3113),d=r(7903),h=r(2744);function g(){let e=(0,o.useRouter)(),{isAuthenticated:t}=(0,n.a)(),{mobileNumber:r,selectedOperator:g,operatorId:m,circleCode:p,circleName:E,setSelectedPlan:f,setAmount:y,setOperatorId:R,setCircleCode:k,setCircleName:A}=(0,i.y)(),[S,v]=(0,a.useState)([]),[I,T]=(0,a.useState)(!1),[x,C]=(0,a.useState)(""),[b,P]=(0,a.useState)("POPULAR"),[w,N]=(0,a.useState)(null),[O,_]=(0,a.useState)(null);(0,a.useEffect)(()=>{if(d.k.info("\uD83D\uDD0D Plans Page - Context Values:",{mobileNumber:r,selectedOperator:null==g?void 0:g.code,operatorId:m,circleCode:p,circleName:E}),m&&p)N(m),_(p);else{d.k.info("⚠️ Context values missing, checking sessionStorage...");let e=sessionStorage.getItem("recharge_operatorId"),t=sessionStorage.getItem("recharge_circleCode"),r=sessionStorage.getItem("recharge_circleName"),s=sessionStorage.getItem("recharge_operatorCode");d.k.info("\uD83D\uDCE6 SessionStorage values:",{storedOperatorId:e,storedCircleCode:t,storedCircleName:r,storedOperatorCode:s}),e&&t?(d.k.info("✅ Restored from sessionStorage"),N(e),_(t),R(e),k(t),r&&A(r)):d.k.warn("❌ No values in sessionStorage either")}},[]),(0,a.useEffect)(()=>{if(!t){e.push(l.Z6.LOGIN);return}let s=w||m,a=O||p;if(!r||!s||!a){d.k.warn("Missing required data for plans fetch",{mobileNumber:r,effectiveOperatorId:s,effectiveCircleCode:a,contextOperatorId:m,contextCircleCode:p,localOperatorId:w,localCircleCode:O}),C("Please detect operator first. Redirecting..."),setTimeout(()=>{e.push(l.Z6.RECHARGE)},2e3);return}D()},[t,b,m,p,w,O]);let D=async()=>{let e=w||m,t=O||p,r=g;if(!r){let e=sessionStorage.getItem("recharge_operatorCode"),t=sessionStorage.getItem("recharge_operatorName");e&&(r={code:e,name:t||e},d.k.info("\uD83D\uDCE6 Using operator from sessionStorage:",r))}if(!r||!e||!t){let s="Missing data - Please detect operator first";d.k.error(s,{hasOperator:!!r,hasOperatorId:!!e,hasCircleCode:!!t}),C(s);return}T(!0),C("");try{d.k.info("\uD83D\uDD0D Fetching plans with KWIKAPI data:",{operator:r.code,operatorName:r.name,operatorId:e,circleCode:t,category:b});let s=await u.F.getPlans({operator:r.code,operatorId:e,circleCode:t,category:b});v(s),d.k.info("✅ Fetched ".concat(s.length," plans from KWIKAPI"))}catch(e){C(e instanceof Error?e.message:"Failed to fetch plans"),d.k.error("❌ Plans fetch failed:",e)}finally{T(!1)}},U=t=>{d.k.info("\uD83D\uDCCB Plan selected:",t),f(t),y(t.amount);let s=w||m,a=r||sessionStorage.getItem("recharge_mobile_number")||"",o=(null==g?void 0:g.name)||sessionStorage.getItem("recharge_operatorName")||"Unknown",n=E||sessionStorage.getItem("recharge_circleName")||"India";sessionStorage.setItem("recharge_mobile_number",a),sessionStorage.setItem("recharge_amount",t.amount.toString()),sessionStorage.setItem("recharge_operator",o),sessionStorage.setItem("recharge_operator_id",s||""),sessionStorage.setItem("recharge_circle_name",n),d.k.info("\uD83D\uDCBE Stored plan details for checkout:",{mobile:a,amount:t.amount,operator:o,operatorId:s,circle:n,planId:t.id}),e.push("/checkout")};return(0,s.jsxs)("div",{className:"min-h-screen",children:[(0,s.jsx)("header",{className:"bg-secondary-light border-b border-white/10 sticky top-0 z-10",children:(0,s.jsxs)("div",{className:"max-w-3xl mx-auto px-4 py-4 flex items-center gap-4",children:[(0,s.jsx)("button",{onClick:()=>e.back(),className:"p-2 hover:bg-background-card rounded-lg transition-colors",children:(0,s.jsx)(h.KYK,{size:24})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-2xl font-display font-bold text-white",children:"Select Plan"}),(0,s.jsxs)("p",{className:"text-sm text-gray-400",children:[r," • ",null==g?void 0:g.name]})]})]})}),(0,s.jsxs)("main",{className:"max-w-3xl mx-auto px-4 py-6",children:[x&&(0,s.jsx)("div",{className:"mb-4 p-3 bg-accent-error/20 border border-accent-error/50 rounded-lg text-accent-error text-sm",children:x}),(0,s.jsx)("div",{className:"mb-6 flex gap-2 overflow-x-auto",children:[{value:"POPULAR",label:"Popular"},{value:"DATA",label:"Data"},{value:"UNLIMITED",label:"Unlimited"},{value:"TALKTIME",label:"Talktime"}].map(e=>(0,s.jsx)("button",{onClick:()=>P(e.value),className:"\n                px-4 py-2 rounded-lg font-medium whitespace-nowrap transition-all\n                ".concat(b===e.value?"bg-primary text-white":"bg-background-card text-gray-400 hover:bg-background-hover","\n              "),children:e.label},e.value))}),I&&(0,s.jsxs)("div",{className:"text-center py-12",children:[(0,s.jsx)("div",{className:"inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-primary"}),(0,s.jsx)("p",{className:"mt-4 text-gray-400",children:"Loading plans from KWIKAPI..."})]}),!I&&S.length>0&&(0,s.jsx)("div",{className:"space-y-3",children:S.map(e=>(0,s.jsx)(c.Zb,{className:"p-4 cursor-pointer hover:border-primary/50 transition-colors",onClick:()=>U(e),children:(0,s.jsxs)("div",{className:"flex items-start justify-between",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,s.jsxs)("span",{className:"text-2xl font-bold text-primary",children:["₹",e.amount]}),(0,s.jsx)("span",{className:"text-sm text-gray-400 bg-background-card px-2 py-1 rounded",children:e.validity})]}),(0,s.jsx)("p",{className:"text-sm text-gray-300 mb-3",children:e.description}),e.benefits&&e.benefits.length>0&&(0,s.jsx)("div",{className:"space-y-1",children:e.benefits.slice(0,3).map((e,t)=>(0,s.jsxs)("div",{className:"flex items-start gap-2 text-xs text-gray-400",children:[(0,s.jsx)(h.ZSR,{className:"flex-shrink-0 mt-0.5 text-green-500"}),(0,s.jsx)("span",{children:e})]},t))}),e.data&&"NA"!==e.data&&(0,s.jsxs)("div",{className:"mt-2 inline-block px-2 py-1 bg-blue-500/10 text-blue-400 text-xs rounded",children:["\uD83D\uDCCA ",e.data]})]}),(0,s.jsx)("button",{className:"ml-4 px-4 py-2 bg-primary hover:bg-primary-hover text-white rounded-lg font-medium transition-colors",children:"Select"})]})},e.id))}),!I&&0===S.length&&!x&&(0,s.jsxs)("div",{className:"text-center py-12",children:[(0,s.jsx)("p",{className:"text-gray-400",children:"No plans available for this category"}),(0,s.jsx)(c.zx,{variant:"outline",className:"mt-4",onClick:()=>P("POPULAR"),children:"View Popular Plans"})]})]})]})}},9765:function(e,t,r){"use strict";r.d(t,{AuthProvider:function(){return h},a:function(){return g}});var s=r(7437),a=r(2265),o=r(3976),n=r(7571),i=r(4569);class c{async register(e){return await n.E.post(o.Pn.AUTH.REGISTER,e)}async login(e){var t,r;let s=await n.E.post(o.Pn.AUTH.LOGIN,e);return(null===(t=s.tokens)||void 0===t?void 0:t.accessToken)&&(null===(r=s.tokens)||void 0===r?void 0:r.refreshToken)&&(i.t.saveTokens(s.tokens.accessToken,s.tokens.refreshToken),i.t.saveUser(s.user)),s}async requestOtp(e){return n.E.post(o.Pn.AUTH.REQUEST_OTP,e)}async loginWithOtp(e){var t,r;let s=await n.E.post(o.Pn.AUTH.OTP_LOGIN,e);return(null===(t=s.tokens)||void 0===t?void 0:t.accessToken)&&(null===(r=s.tokens)||void 0===r?void 0:r.refreshToken)&&(i.t.saveTokens(s.tokens.accessToken,s.tokens.refreshToken),i.t.saveUser(s.user)),s}async verifyEmail(e){return n.E.post(o.Pn.AUTH.VERIFY_EMAIL,{token:e})}async resendVerification(e){return n.E.post(o.Pn.AUTH.RESEND_VERIFICATION,{userId:e})}async logout(){try{await n.E.post(o.Pn.AUTH.LOGOUT,{})}finally{i.t.clearAuth()}}async refreshToken(){var e,t;let r=i.t.getRefreshToken();if(!r)throw Error("No refresh token available");let s=await n.E.post(o.Pn.AUTH.REFRESH_TOKEN,{refreshToken:r});return(null===(e=s.tokens)||void 0===e?void 0:e.accessToken)&&(null===(t=s.tokens)||void 0===t?void 0:t.refreshToken)&&i.t.saveTokens(s.tokens.accessToken,s.tokens.refreshToken),s}isAuthenticated(){return!!i.t.getAccessToken()}getCurrentUser(){return i.t.getUser()}}let l=new c;var u=r(7903);let d=(0,a.createContext)(void 0);function h(e){let{children:t}=e,[r,o]=(0,a.useState)(null),[n,c]=(0,a.useState)(!0);(0,a.useEffect)(()=>{(()=>{try{let e=i.t.getUser(),t=i.t.getAccessToken();e&&t&&o(e)}catch(e){u.k.error("Error initializing auth",e)}finally{c(!1)}})()},[]);let h=async e=>{try{let t=await l.login(e);o(t.user),u.k.info("Login successful")}catch(e){throw u.k.error("Login failed",e),e}},g=async e=>{try{await l.register(e),u.k.info("Registration successful")}catch(e){throw u.k.error("Registration failed",e),e}},m=async e=>{try{await l.requestOtp(e),u.k.info("OTP requested successfully")}catch(e){throw u.k.error("OTP request failed",e),e}},p=async e=>{try{let t=await l.loginWithOtp(e);o(t.user),u.k.info("OTP login successful")}catch(e){throw u.k.error("OTP login failed",e),e}},E=async e=>{try{await l.verifyEmail(e),u.k.info("Email verified successfully")}catch(e){throw u.k.error("Email verification failed",e),e}},f=async e=>{try{await l.resendVerification(e),u.k.info("Verification email resent")}catch(e){throw u.k.error("Resend verification failed",e),e}},y=async()=>{try{await l.logout(),o(null),u.k.info("Logout successful")}catch(e){u.k.error("Logout failed",e),o(null)}},R=async()=>{try{let e=i.t.getUser();o(e)}catch(e){u.k.error("Error refreshing user",e)}};return(0,s.jsx)(d.Provider,{value:{user:r,isAuthenticated:!!r,isLoading:n,login:h,register:g,requestOtp:m,loginWithOtp:p,verifyEmail:E,resendVerification:f,logout:y,refreshUser:R},children:t})}function g(){let e=(0,a.useContext)(d);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},9034:function(e,t,r){"use strict";r.d(t,{RechargeProvider:function(){return c},y:function(){return l}});var s=r(7437),a=r(2265),o=r(3113),n=r(7903);let i=(0,a.createContext)(void 0);function c(e){let{children:t}=e,[r,c]=(0,a.useState)(null),[l,u]=(0,a.useState)(null),[d,h]=(0,a.useState)(null),[g,m]=(0,a.useState)(""),[p,E]=(0,a.useState)(0),[f,y]=(0,a.useState)(!1),[R,k]=(0,a.useState)(null),[A,S]=(0,a.useState)(null),[v,I]=(0,a.useState)(null),T=async e=>{y(!0);try{let t=await o.F.detectOperator({mobileNumber:e});n.k.info("Operator detected",t),m(e)}catch(e){throw n.k.error("Error detecting operator",e),e}finally{y(!1)}},x=async e=>{y(!0);try{let t=await o.F.processMobileRecharge(e);return n.k.info("Recharge processed",t),t}catch(e){throw n.k.error("Error processing recharge",e),e}finally{y(!1)}};return(0,s.jsx)(i.Provider,{value:{selectedOperator:r,selectedCircle:l,selectedPlan:d,mobileNumber:g,amount:p,isLoading:f,operatorId:R,circleCode:A,circleName:v,setSelectedOperator:c,setSelectedCircle:u,setSelectedPlan:h,setMobileNumber:m,setAmount:E,setOperatorId:k,setCircleCode:S,setCircleName:I,detectOperator:T,processRecharge:x,resetRecharge:()=>{c(null),u(null),h(null),m(""),E(0),k(null),S(null),I(null)}},children:t})}function l(){let e=(0,a.useContext)(i);if(void 0===e)throw Error("useRecharge must be used within a RechargeProvider");return e}},7571:function(e,t,r){"use strict";r.d(t,{E:function(){return c}});var s=r(3976),a=r(7903),o=r(4569);class n extends Error{constructor(e,t,r){super(e),this.statusCode=t,this.response=r,this.name="ApiError"}}class i{async request(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=new AbortController,i=setTimeout(()=>r.abort(),this.timeout),c="".concat(this.baseUrl).concat(e),l=o.t.getAccessToken();a.k.logApiCall(t.method||"GET",e,t.body?JSON.parse(t.body):void 0);try{let o=await fetch(c,{...t,signal:r.signal,headers:{"Content-Type":"application/json",...l?{Authorization:"Bearer ".concat(l)}:{},...t.headers}});clearTimeout(i);let u=await o.json();if(a.k.logApiResponse(e,o.status,u),!o.ok)throw new n(u.message||s.RZ.SOMETHING_WENT_WRONG,o.status,u);return u}catch(t){if(clearTimeout(i),t instanceof n)throw t;if(t instanceof Error&&"AbortError"===t.name)throw a.k.error("API request timeout",t,{endpoint:e}),new n("Request timeout. Please try again.");throw a.k.error("API network error",t,{endpoint:e}),new n(s.RZ.NETWORK_ERROR)}}async get(e,t){return this.request(e,{method:"GET",headers:t?{Authorization:"Bearer ".concat(t)}:{}})}async post(e,t,r){return this.request(e,{method:"POST",body:JSON.stringify(t),headers:r?{Authorization:"Bearer ".concat(r)}:{}})}async put(e,t,r){return this.request(e,{method:"PUT",body:JSON.stringify(t),headers:r?{Authorization:"Bearer ".concat(r)}:{}})}async delete(e,t){return this.request(e,{method:"DELETE",headers:t?{Authorization:"Bearer ".concat(t)}:{}})}async patch(e,t,r){return this.request(e,{method:"PATCH",body:JSON.stringify(t),headers:r?{Authorization:"Bearer ".concat(r)}:{}})}constructor(){this.baseUrl=s.Hz.BASE_URL,this.timeout=s.Hz.TIMEOUT}}let c=new i},3113:function(e,t,r){"use strict";r.d(t,{F:function(){return n}});var s=r(3976),a=r(7571);class o{async detectOperator(e){return a.E.post(s.Pn.RECHARGE.DETECT_OPERATOR,e)}async getOperators(){return a.E.get(s.Pn.RECHARGE.GET_OPERATORS)}async getCircles(e){return a.E.get(s.Pn.RECHARGE.GET_CIRCLES(e))}async getAllCircles(){return a.E.get(s.Pn.RECHARGE.GET_ALL_CIRCLES)}async fetchAndStoreCircles(){return a.E.post(s.Pn.RECHARGE.FETCH_AND_STORE_CIRCLES,{})}async getAllOperatorsFromDB(){return a.E.get(s.Pn.RECHARGE.GET_ALL_OPERATORS)}async fetchAndStoreOperators(){return a.E.post(s.Pn.RECHARGE.FETCH_AND_STORE_OPERATORS,{})}async getPlans(e){let t=new URLSearchParams;return t.append("operatorCode",e.operator),e.circleCode&&t.append("circleCode",e.circleCode),e.circle&&t.append("circleCode",e.circle),e.category&&t.append("category",e.category),e.operatorId&&t.append("operatorId",e.operatorId),a.E.get("".concat(s.Pn.RECHARGE.GET_PLANS,"?").concat(t.toString()))}async validateRecharge(e){return a.E.post(s.Pn.RECHARGE.VALIDATE,e)}async processMobileRecharge(e){return a.E.post(s.Pn.RECHARGE.PROCESS_MOBILE,e)}async getHistory(e){let t=e?new URLSearchParams(e).toString():"";return a.E.get("".concat(s.Pn.RECHARGE.GET_HISTORY).concat(t?"?".concat(t):""))}async getFavorites(){return a.E.get(s.Pn.RECHARGE.GET_FAVORITES)}async addFavorite(e){return a.E.post(s.Pn.RECHARGE.ADD_FAVORITE,e)}async removeFavorite(e){return a.E.delete(s.Pn.RECHARGE.REMOVE_FAVORITE(e))}async getKwikApiBalance(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return a.E.get("".concat(s.Pn.RECHARGE.KWIKAPI_BALANCE).concat(e?"?forceRefresh=true":""))}async processKwikApiRecharge(e){return a.E.post(s.Pn.RECHARGE.KWIKAPI_RECHARGE,{number:e.mobileNumber,amount:e.amount,opid:e.operatorId,state_code:0,order_id:e.orderId})}async checkKwikApiStatus(e){return a.E.get("".concat(s.Pn.RECHARGE.KWIKAPI_STATUS,"?orderId=").concat(e))}async completeRecharge(e){try{let t="".concat(Date.now()).concat(Math.floor(1e6*Math.random()).toString().padStart(6,"0")),r=await this.processKwikApiRecharge({mobileNumber:e.mobileNumber,amount:e.amount,operatorId:e.operatorId,orderId:t});console.log("KWIKAPI Recharge Response:",r),await this.sleep(5e3);for(let e=1;e<=3;e++){let r=await this.checkKwikApiStatus(t),s=r.response.status;if(console.log("Status Check Attempt ".concat(e,"/3:"),s),"SUCCESS"===s)return{success:!0,status:"SUCCESS",message:"Recharge successful!",data:r.response};if("FAILED"===s)return{success:!1,status:"FAILED",message:"Recharge failed",data:r.response};if("PENDING"===s){if(e<3)await this.sleep(3e4);else break}}return{success:!1,status:"TIMEOUT",message:"Status check timeout - please check later"}}catch(e){throw console.error("Complete recharge failed:",e),e}}sleep(e){return new Promise(t=>setTimeout(t,e))}}let n=new o},7903:function(e,t,r){"use strict";r.d(t,{k:function(){return a}});class s{log(e,t,r){if(!this.isDevelopment&&"debug"===e)return;let s=new Date().toISOString(),a="[".concat(s,"] [").concat(e.toUpperCase(),"]");switch(e){case"info":console.log(a,t,r||"");break;case"warn":console.warn(a,t,r||"");break;case"error":console.error(a,t,r||"");break;case"debug":console.debug(a,t,r||"")}}info(e,t){this.log("info",e,t)}warn(e,t){this.log("warn",e,t)}error(e,t,r){this.log("error",e,{error:t,...r})}debug(e,t){this.log("debug",e,t)}logApiCall(e,t,r){this.debug("API ".concat(e," ").concat(t),r)}logApiResponse(e,t,r){this.debug("API Response ".concat(e),{status:t,data:r})}constructor(){this.isDevelopment=!1}}let a=new s},4569:function(e,t,r){"use strict";r.d(t,{t:function(){return o}});var s=r(3976);class a{setItem(e,t){if(this.isClient)try{let r=JSON.stringify(t);localStorage.setItem(e,r)}catch(e){}}getItem(e){if(!this.isClient)return null;try{let t=localStorage.getItem(e);return t?JSON.parse(t):null}catch(e){return null}}removeItem(e){if(this.isClient)try{localStorage.removeItem(e)}catch(e){}}clear(){if(this.isClient)try{localStorage.clear()}catch(e){}}saveTokens(e,t){this.setItem(s.I.ACCESS_TOKEN,e),this.setItem(s.I.REFRESH_TOKEN,t)}getAccessToken(){return this.getItem(s.I.ACCESS_TOKEN)}getRefreshToken(){return this.getItem(s.I.REFRESH_TOKEN)}clearTokens(){this.removeItem(s.I.ACCESS_TOKEN),this.removeItem(s.I.REFRESH_TOKEN)}saveUser(e){this.setItem(s.I.USER_DATA,e)}getUser(){return this.getItem(s.I.USER_DATA)}clearUser(){this.removeItem(s.I.USER_DATA)}clearAuth(){this.clearTokens(),this.clearUser()}constructor(){this.isClient=!0}}let o=new a}},function(e){e.O(0,[51,38,659,971,117,744],function(){return e(e.s=6874)}),_N_E=e.O()}]);